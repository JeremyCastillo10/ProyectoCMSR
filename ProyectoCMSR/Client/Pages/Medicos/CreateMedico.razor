@page "/createMedico"
@using CurrieTechnologies.Razor.SweetAlert2
@using Newtonsoft.Json
@using ProyectoCMSR.Shared.DTOS
@inject HttpClient Http
@inject SweetAlertService swal;
@inject NavigationManager navManager;
<EditForm Model="medico" OnValidSubmit="Guardar">
    <FormMedico medico="medico"></FormMedico>
    <MudCardActions>
        <MudItem xs="12" Class="mt-4">
            <MudContainer Class="d-flex justify-center">
                <MudIconButton OnClick="Guardar" Icon="@Icons.Material.Filled.Save"></MudIconButton>
            </MudContainer>
        </MudItem>
    </MudCardActions>

</EditForm>

@code {
    [Parameter]
    public Medicos_M medico { get; set; } = new Medicos_M();
    private string base64Image;
    protected override async Task OnInitializedAsync()
    {

    }
    private async Task Guardar()
    {
        medico.ImagenBase64 = base64Image;
        var response = await Http.PostAsJsonAsync("api/medicos", medico);

        if (response.IsSuccessStatusCode)
        {
            alertGuarda();
        }
        else
        {
            alertNoGuarda();
        }
    }

    private async Task<Medicos_M> GetMedicoPorIdAsync(int id)
    {
        var response = await Http.GetAsync($"api/medicos/{id}");
        if (response.IsSuccessStatusCode)
        {
            var content = await response.Content.ReadAsStringAsync();
            return JsonConvert.DeserializeObject<Medicos_M>(content);
        }
        return null;
    }

    private async Task HandleFileSelected(InputFileChangeEventArgs e)
    {
        var file = e.File;
        var buffer = new byte[file.Size];
        await file.OpenReadStream().ReadAsync(buffer);
        base64Image = Convert.ToBase64String(buffer);
        medico.ImagenBase64 = base64Image;
    }
    public async void alertGuarda()
    {
        var res = await swal.FireAsync(new SweetAlertOptions
            {
                Title = "Exito",
                Text = "Guardado con exito!!!",
                Icon = SweetAlertIcon.Success,
                ConfirmButtonText = "OK"

            });
    }
    public async void alertNoGuarda()
    {
        var res = await swal.FireAsync(new SweetAlertOptions
            {
                Title = "Error",
                Text = "No Guarda!!!",
                Icon = SweetAlertIcon.Error,
                ConfirmButtonText = "OK"

            });
    }
}
